const fs = require('fs');
const path = require('path');

const packageJsonPath = path.resolve(__dirname, '../package.json');
const registryPath = path.resolve(
	__dirname,
	'../src/auto-import-registry.d.ts',
);

const packageJson = require(packageJsonPath);

const allDeps = {
	...packageJson.dependencies,
	...packageJson.devDependencies,
};

const signozPackages = Object.keys(allDeps).filter((dep) =>
	dep.startsWith('@signozhq/'),
);

const fileContent = `// -------------------------------------------------------------------------
// AUTO-GENERATED FILE
// -------------------------------------------------------------------------
// This file is generated by scripts/update-registry.cjs automatically
// whenever you run 'yarn install' or 'npm install'.
//
// It forces VS Code to index these specific packages to fix auto-import
// performance issues in TypeScript 4.x.
//
// PR for reference: https://github.com/SigNoz/signoz/pull/9694
// -------------------------------------------------------------------------

${signozPackages.map((pkg) => `import '${pkg}';`).join('\n')}
`;

try {
	fs.writeFileSync(registryPath, fileContent);
	console.log(
		`Auto-import registry updated with ${signozPackages.length} @signozhq packages.`,
	);
} catch (err) {
	console.error('Failed to update auto-import registry:', err);
}
